/*!
stream.js, by Anders Ytterstr√∂m (c) 2013
Docs: https://github.com/madr/stream.js

Free to distribute under the MIT License: 
http://opensource.org/licenses/MIT
*/
(function(c){var e,a,b,d;d="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";b=(function(){return{addClass:function(f,g){f.classList.add(g)},removeClass:function(f,g){f.classList.remove(g)},httpObj:function(){var g=false;if(c.XMLHttpRequest){g=new c.XMLHttpRequest()}else{if(c.ActiveXObject){try{g=new c.ActiveXObject("Msxml2.XMLHTTP")}catch(f){g=false}}}return g}}}());e=function(h,k){var g,f=[],j=k.length;this.stream=h;for(g=0;g<j;g++){f[g]=new a(k[g])}this.pages=f;this.last=f.length};e.prototype={constructor:e,injectPage:function(f){this.pages.push(new a(f));this.last=this.pages.length},fetchPage:function(f,h){var g=b.httpObj();if(g){g.onreadystatechange=function(){if(g.readyState===4){if(g.status===200||g.status===304){h(g.responseText)}}};g.open("GET",f,true);g.send(null)}},loadPage:function(f){if(!f.loaded&&f.source!==undefined){this.fetchPage(f.source,function(g){var h=document.createElement("div");h.innerHTML=g;f.content.appendChild(h);f.load(f.content)})}},fixPresent:function(f){var g=this.pages[f];if(!g.loaded){g.load(g.content)}g.loadImgs();g.makeVis();g.readd()},fixPage:function(g,f){switch(f){case 1:this.loadPage(this.pages[g]);this.pages[g].makeVis();this.pages[g].loadImgs();this.pages[g].readd();break;case 2:this.loadPage(this.pages[g]);this.pages[g].unloadImgs();this.pages[g].makeVis();this.pages[g].readd();break;case 3:this.loadPage(this.pages[g]);this.pages[g].unloadImgs();this.pages[g].makeInvis();this.pages[g].readd();break;case 4:this.pages[g].remove();break}},fixFuture:function(f){if(++f<this.last){this.fixPage(f,1)}if(++f<this.last){this.fixPage(f,2)}if(++f<this.last){this.fixPage(f,3)}while(++f<this.last){this.fixPage(f,4)}},fixPast:function(f){if(f-->0){this.fixPage(f,1)}if(f-->0){this.fixPage(f,2)}if(f-->0){this.fixPage(f,3)}while(f-->0){this.fixPage(f,4)}},gotoX:function(f,g){if(g===undefined){g="both"}this.current=f;this.fixPresent(f);if(g!=="prev"){this.fixFuture(f)}if(g!=="next"){this.fixPast(f)}},init:function(f){this.gotoX(f||0)},gotoNext:function(){var f=this.current;if(f<(this.pages.length-1)){f++}this.gotoX(f)},gotoPrev:function(){var f=this.current;if(f>0){f--}this.gotoX(f)},addPage:function(f,h){var g;if(h===undefined){h=true}g=new a(f);if(h===true){this.pages.push(g);return}if(h===false){this.pages.unshift(g);return}h=parseInt(h,10);this.pages.splice(h,0,g)}};a=function(f){var g=f.getAttribute("data-source");if(g){this.loaded=false;this.source=g;this.content=f}else{this.load(f)}};a.prototype={constructor:a,load:function(f){this.content=f;this.parent=f.parentNode;var g=document.createElement("span");g.className=this.content.className;this.dummy=g;this.imgs=f.getElementsByTagName("img");this.imgsLen=this.imgs.length;this.loaded=true;this.source=undefined;this.content.removeAttribute("data-source");this.pageInvis=false;this.imgsUnloaded=false;this.pageRemoved=false},remove:function(){if(!this.loaded||this.pageRemoved){return}if(this.content.style.length){this.dummy.style=this.content.style}this.dummy.className=this.content.className;this.parent.insertBefore(this.dummy,this.content);this.content=this.parent.removeChild(this.content);this.pageRemoved=true},readd:function(){if(!this.loaded||!this.pageRemoved){return}if(this.dummy.style.width){this.content.style.width=this.dummy.style.width}this.parent.insertBefore(this.content,this.dummy);this.dummy=this.parent.removeChild(this.dummy);this.pageRemoved=false},unloadImgs:function(){if(!this.loaded||this.imgsUnloaded){return}var h,f,g,k,j=this.imgs;k=this.imgsLen&&!!j[0].getAttribute("data-src");for(h=0,f=this.imgsLen;h<f;h++){g=j[h];if(!k){g.setAttribute("data-src",g.src)}g.src=d}this.imgsUnloaded=true},loadImgs:function(){if(!this.loaded||!this.imgsUnloaded){return}var h,f,g,j=this.imgs;for(h=0,f=this.imgsLen;h<f;h++){g=j[h];g.src=g.getAttribute("data-src")}this.imgsUnloaded=false},makeInvis:function(){if(!this.loaded||this.pageInvis){return}b.addClass(this.content,"is-hidden");this.pageInvis=true},makeVis:function(){if(!this.loaded||!this.pageInvis){return}b.removeClass(this.content,"is-hidden");this.pageInvis=false}};c.streamjs={};c.streamjs.Helper=b;c.streamjs.Page=a;c.streamjs.Stream=e}(this));