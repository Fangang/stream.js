/*!
stream.js, by Anders Ytterstr√∂m (c) 2013
Docs: https://github.com/madr/stream.js

Free to distribute under the MIT License: 
http://opensource.org/licenses/MIT
*/
(function(c){var e,a,d,b;d="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";b=function(){var f=false;if(window.XMLHttpRequest){f=new XMLHttpRequest()}return f};e=function(h,k){var g,f=[],j=k.length;this.stream=h;for(g=0;g<j;g++){f[g]=new a(k[g])}this.pages=f;this.last=f.length};e.prototype={constructor:e,injectPage:function(f){this.pages.push(new a(f));this.last=this.pages.length},fetchPage:function(f,h){var g=b();if(g){g.onreadystatechange=function(){if(g.readyState===4){if(g.status===200||g.status===304){h(g.responseText)}}};g.open("GET",f,true);g.send(null)}},loadPage:function(f){if(!f.loaded&&f.source!==undefined){this.fetchPage(f.source,function(g){var h=document.createElement("div");h.innerHTML=g;f.content.appendChild(h);f.load(f.content)})}},fixPresent:function(f){var g=this.pages[f];if(!g.loaded){g.load(g.content)}g.loadImgs();g.makeVis();g.readd()},fixFuture:function(f){if(++f<this.last){this.loadPage(this.pages[f]);this.pages[f].makeVis();this.pages[f].loadImgs();this.pages[f].readd()}if(++f<this.last){this.loadPage(this.pages[f]);this.pages[f].unloadImgs();this.pages[f].makeVis();this.pages[f].readd()}if(++f<this.last){this.loadPage(this.pages[f]);this.pages[f].unloadImgs();this.pages[f].makeInvis();this.pages[f].readd()}while(++f<this.last){this.pages[f].remove()}},fixPast:function(f){if(f-->0){this.loadPage(this.pages[f]);this.pages[f].makeVis();this.pages[f].loadImgs();this.pages[f].readd()}if(f-->0){this.loadPage(this.pages[f]);this.pages[f].unloadImgs();this.pages[f].makeVis();this.pages[f].readd()}if(f-->0){this.loadPage(this.pages[f]);this.pages[f].unloadImgs();this.pages[f].makeInvis();this.pages[f].readd()}while(f-->0){this.pages[f].remove()}},gotoX:function(f,g){if(g===undefined){g="both"}this.current=f;this.fixPresent(f);if(g!=="prev"){this.fixFuture(f)}if(g!=="next"){this.fixPast(f)}},init:function(f){this.gotoX(f||0)},resizePages:function(h){var g=this.pages,j,f=g.length;for(j=0;j<f;j++){g[j].content.style.width=h+"px";if(g[j].loaded){g[j].dummy.style.width=h+"px"}}},gotoNext:function(){var f=this.current;if(f<(this.pages.length-1)){f++}this.gotoX(f)},gotoPrev:function(){var f=this.current;if(f>0){f--}this.gotoX(f)}};a=function(f){var g=f.getAttribute("data-source");if(g){this.loaded=false;this.source=g;this.content=f}else{this.load(f)}};a.prototype={constructor:a,load:function(f){this.content=f;this.parent=f.parentNode;var g=document.createElement("span");g.className=this.content.className;this.dummy=g;this.imgs=f.getElementsByTagName("img");this.imgsLen=this.imgs.length;this.loaded=true;this.source=undefined;this.content.removeAttribute("data-source");this.pageInvis=false;this.imgsUnloaded=false;this.pageRemoved=false},remove:function(){if(!this.loaded||this.pageRemoved){return}if(this.content.style.width){this.dummy.style.width=this.content.style.width}this.parent.insertBefore(this.dummy,this.content);this.content=this.parent.removeChild(this.content);this.pageRemoved=true},readd:function(){if(!this.loaded||!this.pageRemoved){return}if(this.dummy.style.width){this.content.style.width=this.dummy.style.width}this.parent.insertBefore(this.content,this.dummy);this.dummy=this.parent.removeChild(this.dummy);this.pageRemoved=false},unloadImgs:function(){if(!this.loaded||this.imgsUnloaded){return}var h,f,g,k,j=this.imgs;k=this.imgsLen&&!!j[0].getAttribute("data-src");for(h=0,f=this.imgsLen;h<f;h++){g=j[h];if(!k){g.setAttribute("data-src",g.src)}g.src=d}this.imgsUnloaded=true},loadImgs:function(){if(!this.loaded||!this.imgsUnloaded){return}var h,f,g,j=this.imgs;for(h=0,f=this.imgsLen;h<f;h++){g=j[h];g.src=g.getAttribute("data-src")}this.imgsUnloaded=false},addClass:function(f){this.content.classList.add(f)},removeClass:function(f){this.content.classList.remove(f)},makeInvis:function(){if(!this.loaded||this.pageInvis){return}this.addClass("is-hidden");this.pageInvis=true},makeVis:function(){if(!this.loaded||!this.pageInvis){return}this.removeClass("is-hidden");this.pageInvis=false}};c.stream={};c.stream.Page=a;c.stream.Stream=e}(this));